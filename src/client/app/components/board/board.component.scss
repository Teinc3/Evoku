@use '../../../globals' as *;

/** Animation timing constants */
$pulse-duration: 1.5s;
$pulse-color: rgba(255, 140, 0, 0.7);

/**
 * Mixin for pulsing grid line overlays
 * @param {string} $direction - 'horizontal', 'vertical', or 'box'
 */
@mixin pulse-grid-lines($direction) {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 3;
  animation: pulse-glow $pulse-duration ease-in-out infinite;

  @if $direction == 'horizontal' {
    background: repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent calc(11.11% - 2px),
      $pulse-color calc(11.11% - 2px),
      $pulse-color calc(11.11% + 2px),
      transparent calc(11.11% + 2px)
    );
  } @else if $direction == 'vertical' {
    background: repeating-linear-gradient(
      to right,
      transparent 0,
      transparent calc(11.11% - 2px),
      $pulse-color calc(11.11% - 2px),
      $pulse-color calc(11.11% + 2px),
      transparent calc(11.11% + 2px)
    );
  } @else if $direction == 'box' {
    background: 
      repeating-linear-gradient(
        to bottom,
        transparent 0,
        transparent calc(33.33% - 3px),
        $pulse-color calc(33.33% - 3px),
        $pulse-color calc(33.33% + 3px),
        transparent calc(33.33% + 3px)
      ),
      repeating-linear-gradient(
        to right,
        transparent 0,
        transparent calc(33.33% - 3px),
        $pulse-color calc(33.33% - 3px),
        $pulse-color calc(33.33% + 3px),
        transparent calc(33.33% + 3px)
      );
  }
}

@keyframes pulse-glow {
  0%, 100% {
    opacity: 0.6;
  }
  50% {
    opacity: 1;
  }
}

:host {
  aspect-ratio: 1/1;
  display: flex;
  width: 100%;
  height: 100%;
}

.board {
  /* Parent now controls outer width; board enforces square shape */
  aspect-ratio: 1 / 1;
  display: grid;
  flex-grow: 1;
  align-self: center;
  grid-template-columns: repeat(9, 1fr);
  grid-template-rows: repeat(9, 1fr);
  position: relative; /* for overlay lines */
  border: 6px solid #000;
  box-sizing: border-box;
  max-width: 100%;
  max-height: 100%;

  &.threat-border {
    border-color: $pulse-color;
    animation: threat-pulse $pulse-duration ease-in-out infinite;
  }
}

.global-cooldown-overlay {
  @extend %cooldown-overlay-base;
  background: conic-gradient(from 0deg, rgba(172, 172, 172, 0.2) 0deg var(--angle), transparent var(--angle) 360deg);
  z-index: 2; /* Above cells */
}

/** Combat layer overlays */
.pulse-row-overlay {
  @include pulse-grid-lines('horizontal');
}

.pulse-col-overlay {
  @include pulse-grid-lines('vertical');
}

.pulse-box-overlay {
  @include pulse-grid-lines('box');
}

.ghost-target {
  position: absolute;
  background: rgba(255, 100, 50, 0.2);
  border: 2px dashed rgba(255, 100, 50, 0.6);
  pointer-events: none;
  z-index: 1;
  animation: ghost-fade $pulse-duration ease-in-out infinite;
}

@keyframes threat-pulse {
  0%, 100% {
    box-shadow: 0 0 10px $pulse-color;
  }
  50% {
    box-shadow: 0 0 20px $pulse-color;
  }
}

@keyframes ghost-fade {
  0%, 100% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.6;
  }
}