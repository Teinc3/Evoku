/* Properties */
@property --spin-color {
  syntax: '<color>';
  inherits: true;
  initial-value: transparent;
}

@property --spin-opacity {
  syntax: '<number>';
  inherits: true;
  initial-value: 0;
}

@property --settle-opacity {
  syntax: '<number>';
  inherits: true;
  initial-value: 0;
}

/* Colors */
$wood: hsl(125, 60%, 45%);
$fire: hsl(13, 90%, 55%);
$earth: hsl(47, 98%, 49%);
$metal: hsl(0, 0%, 60%);
$water: hsl(200, 90%, 55%);

:host {
  display: block;
  height: 100%;
  aspect-ratio: 1 / 1;
  cursor: pointer;
  transition: transform 0.2s ease;
}

:host(:hover) {
  transform: scale(1.05);
}

:host(.shake) {
  animation: pup-shake 0.35s linear;
}

:host([data-type="wood"]) { --target-color: #{$wood}; }
:host([data-type="fire"]) { --target-color: #{$fire}; }
:host([data-type="earth"]) { --target-color: #{$earth}; }
:host([data-type="metal"]) { --target-color: #{$metal}; }
:host([data-type="water"]) { --target-color: #{$water}; }

.icon-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;

  --aura-blur: 0px;
  --yy-contrast: 0.3;

  --spin-opacity: 0;
  --settle-opacity: 0;

  /* Dual drop-shadow for cross-fading */
  filter: 
    drop-shadow(
      0 0 var(--aura-blur)
      color-mix(
        in srgb,
        transparent calc((1 - var(--spin-opacity)) * 100%),
        var(--spin-color) calc(var(--spin-opacity) * 100%)
      )
    )
    drop-shadow(
      0 0 var(--aura-blur)
      color-mix(
        in srgb,
        transparent calc((1 - var(--settle-opacity)) * 100%),
        var(--target-color, transparent) calc(var(--settle-opacity) * 100%)
      )
    );

  transition: 
    --yy-contrast 0.3s ease,
    --aura-blur 0.35s ease,
    --spin-opacity 1s ease,
    --settle-opacity 1s ease;
}

/* SVG Styles */
::ng-deep svg {
  width: 100%;
  height: 100%;
  display: block;
  filter: contrast(var(--yy-contrast));
  transition: filter 0.35s linear;
}

@keyframes aura-spin {
  0%, 100% { --spin-color: #{$wood}; }
  20% { --spin-color: #{$fire}; }
  40% { --spin-color: #{$earth}; }
  60% { --spin-color: #{$metal}; }
  80% { --spin-color: #{$water}; }
}

@keyframes spin-to-settle {
  0%, 60% {
    --spin-opacity: 1;
    --settle-opacity: 0;
  }
  100% {
    --spin-opacity: 0;
    --settle-opacity: 1;
  }
}

/* States */
:host(.ready) .icon-container {
  animation: aura-spin 2s linear infinite;
  --spin-opacity: 1;
  --settle-opacity: 0;
  --aura-blur: 14px;
  --yy-contrast: 1;
}

:host(.spinning) .icon-container {
  animation:
    aura-spin 0.8s linear infinite,
    spin-to-settle calc(var(--pup-draw-settle-delay-ms) * 1ms) linear forwards;
  --aura-blur: 18px;
  --yy-contrast: 1;
}

:host(.settling) .icon-container {
  --aura-blur: 18px;
  --yy-contrast: 1;
  --spin-opacity: 0;
  --settle-opacity: 1;
  animation: none;
  transition:
    --aura-blur 0.35s linear,
    --yy-contrast 0.35s linear;
}
